<div
  class="context-menu"
  [style.left.px]="contextMenu.x"
  [style.top.px]="contextMenu.y"
  (click)="$event.stopPropagation()"
>
  <div class="context-header">
    {{ contextMenu.selectedCount > 0
      ? contextMenu.selectedCount + ' verses selected'
      : 'Verse options' }}
  </div>

  <button
    class="context-item"
    (click)="markAsMemorized.emit()"
    *ngIf="shouldShowMarkAsMemorized"
  >
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    Mark as memorized
  </button>

  <button
    class="context-item"
    (click)="markAsUnmemorized.emit()"
    *ngIf="shouldShowMarkAsUnmemorized"
  >
    <div class="empty-checkbox"></div>
    Mark as unmemorized
  </button>

  <div class="context-divider"></div>

  <button
    class="context-item"
    (click)="jumpToCrossReferences.emit()"
    *ngIf="contextMenu.selectedCount === 1"
  >
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
    </svg>
    Jump to Cross References
  </button>

  <div class="context-divider" *ngIf="contextMenu.selectedCount === 1"></div>

  <div class="deck-dropdown-container" 
       (mouseenter)="onDeckHover()" 
       (mouseleave)="onDeckLeave()">
    <button class="context-item">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      Add to flashcard deck
      <svg class="chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>

    <div class="deck-dropdown" *ngIf="showDeckDropdown">
      <div class="deck-search-container">
        <input 
          type="text"
          class="deck-search-input"
          [(ngModel)]="deckSearchText"
          (input)="onDeckSearchInput()"
          [placeholder]="'Search ' + flashcardDecks.length + ' decks...'"
          (click)="$event.stopPropagation()"
        />
      </div>
      
      <button class="deck-option create-new" (click)="createNewDeck(); $event.stopPropagation()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Create new deck
      </button>
      
      <div class="deck-divider"></div>
      
      <div class="deck-list">
        <button
          *ngFor="let deck of filteredDecks"
          class="deck-option"
          (click)="selectDeck(deck); $event.stopPropagation()"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="9" x2="15" y2="9"></line>
            <line x1="9" y1="13" x2="15" y2="13"></line>
          </svg>
          {{ deck }}
        </button>
        
        <div class="no-decks-message" *ngIf="deckSearchText && filteredDecks.length === 0">
          No decks found
        </div>
      </div>
    </div>
  </div>
</div>
