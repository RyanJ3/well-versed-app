<div class="nav-buttons">
  <button class="prev-btn" (click)="prev.emit()" [disabled]="!canGoBack">
    Previous
  </button>
  
  <!-- Recording Controls -->
  <div class="recording-controls">
    <!-- Record Button -->
    <button 
      class="record-btn"
      [class.recording]="recordingState.isRecording"
      [class.has-recording]="!!recordingState.audioUrl"
      (click)="onRecordClick()"
      [title]="getRecordTooltip()"
    >
      <svg *ngIf="!recordingState.isRecording" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <circle cx="12" cy="12" r="8"/>
      </svg>
      <svg *ngIf="recordingState.isRecording" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <rect x="6" y="6" width="12" height="12" rx="2"/>
      </svg>
      <span class="record-timer" *ngIf="recordingState.isRecording">
        {{ formatDuration(recordingState.duration) }}
      </span>
    </button>

    <!-- Play Button -->
    <button 
      class="play-btn"
      [disabled]="!recordingState.audioUrl || recordingState.isRecording"
      [class.playing]="isPlaying"
      (click)="onPlayClick()"
      [title]="getPlayTooltip()"
    >
      <svg *ngIf="!isPlaying" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5v14l11-7z"/>
      </svg>
      <svg *ngIf="isPlaying" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <rect x="6" y="4" width="4" height="16"/>
        <rect x="14" y="4" width="4" height="16"/>
      </svg>
      
      <!-- Circular Progress Indicator -->
      <svg class="progress-ring" *ngIf="currentAudio && playbackDuration > 0" width="56" height="56">
        <circle
          class="progress-ring-circle"
          [class.paused]="!isPlaying"
          stroke="#3b82f6"
          stroke-width="3"
          fill="transparent"
          r="25"
          cx="28"
          cy="28"
          [style.stroke-dasharray]="'157 157'"
          [style.stroke-dashoffset]="157 - (157 * (playbackDuration / audioDuration))"
        />
      </svg>

      <!-- Playback Timer -->
      <span class="playback-timer" *ngIf="recordingState.audioUrl && !recordingState.isRecording">
        <span *ngIf="!isPlaying && !currentAudio && recordingState.duration > 0">
          {{ formatDuration(recordingState.duration) }}
        </span>
        <span *ngIf="currentAudio && !isPlaying && playbackDuration > 0">
          {{ formatPlaybackPosition() }}
        </span>
        <span *ngIf="isPlaying" [class.ending]="playbackRemaining < 3">
          {{ formatRemaining(playbackRemaining) }}
        </span>
      </span>
    </button>
  </div>

  <!-- Mic Permission Message -->
  <div class="mic-permission-message" *ngIf="showMicPermissionMessage" @fadeInOut>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
    </svg>
    <span>{{ micPermissionMessage }}</span>
  </div>

  <button class="next-btn" (click)="next.emit()" [disabled]="nextDisabled">
    Next
  </button>
</div>