<!-- frontend/src/app/features/profile/profile.component.html -->
<div class="profile-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && user" class="profile-container">
    <!-- Profile Hero Section -->
    <div class="hero-section">
      <div class="hero-background">
        <div class="hero-gradient"></div>
        <div class="hero-pattern"></div>
      </div>

      <div class="hero-content">
        <div class="profile-avatar">
          <span>{{ user!.name ? user!.name.charAt(0).toUpperCase() : '' }}</span>
        </div>
        <div class="profile-info">
          <h1 class="profile-name">{{ user!.name }}</h1>
          <p class="profile-email">{{ user!.email }}</p>
          <p class="profile-join-date">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Member since {{ user!.createdAt | date:'mediumDate' }}
          </p>
        </div>
      </div>
    </div>

    <div class="profile-content">
      <!-- Settings Form -->
      <div class="settings-card">
        <div class="card-header">
          <h2 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Profile Settings
          </h2>
        </div>
        
        <form (ngSubmit)="saveProfile()" class="settings-form">
          <p class="form-info">Fields marked with <span class="required">*</span> are required.</p>
          
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name <span class="required">*</span></label>
              <input 
                type="text" 
                id="firstName" 
                class="form-control" 
                [(ngModel)]="profileForm.firstName" 
                name="firstName" 
                required
                placeholder="Enter your first name">
            </div>
                
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input 
                type="text" 
                id="lastName" 
                class="form-control" 
                [(ngModel)]="profileForm.lastName" 
                name="lastName"
                placeholder="Enter your last name">
            </div>
          </div>
                
          <div class="form-group">
            <label for="denomination">Denomination</label>
            <div class="select-wrapper">
              <select 
                id="denomination" 
                class="form-control" 
                [(ngModel)]="profileForm.denomination" 
                name="denomination">
                <option *ngFor="let option of denominationOptions" [value]="option.value">
                  {{ option.text }}
                </option>
              </select>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="select-icon">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          </div>

          <!-- Language Selection -->
          <div class="form-group">
            <label for="preferredLanguage">Bible Language <span class="required">*</span></label>
            <div class="select-wrapper">
              <select 
                id="preferredLanguage" 
                class="form-control" 
                [(ngModel)]="profileForm.preferredLanguage" 
                name="preferredLanguage"
                (change)="onLanguageChange()"
                required>
                <option value="">Select Language</option>
                <option *ngFor="let lang of languages" [value]="lang.id">
                  {{ lang.name }} 
                  <span *ngIf="lang.nameLocal && lang.nameLocal !== lang.name">({{ lang.nameLocal }})</span>
                </option>
              </select>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="select-icon">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          </div>
                
          <!-- Bible Translation Selection -->
          <div class="form-group">
            <label for="preferredBible">Preferred Bible Translation <span class="required">*</span></label>
            <div class="select-wrapper">
              <select 
                id="preferredBible" 
                class="form-control" 
                [(ngModel)]="profileForm.preferredBible" 
                name="preferredBible"
                (change)="onBibleChange()"
                [disabled]="loadingBibles || availableBibles.length === 0 || !profileForm.preferredLanguage"
                required>
                <option value="">
                  {{ !profileForm.preferredLanguage ? 'Please select a language first' :
                     loadingBibles ? 'Loading Bibles...' : 
                     availableBibles.length === 0 ? 'No Bibles available for selected language' : 
                     'Select Bible Translation' }}
                </option>
                <option *ngFor="let bible of availableBibles" [value]="bible.abbreviation">
                  {{ bible.name }} ({{ bible.abbreviation }})
                </option>
              </select>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="select-icon">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
            <small class="form-text" *ngIf="selectedBibleId && profileForm.preferredBible !== 'ESV'">
              Bible ID: {{ selectedBibleId }}
            </small>
          </div>

          <!-- ESV API Token (only show if ESV is selected) -->
          <div class="form-group" *ngIf="profileForm.preferredBible === 'ESV'">
            <label for="esvApiToken">ESV API Token <span class="required">*</span></label>
            <input
              type="text"
              id="esvApiToken"
              class="form-control"
              [(ngModel)]="profileForm.esvApiToken"
              name="esvApiToken"
              placeholder="Enter your ESV API token"
              [required]="profileForm.preferredBible === 'ESV'">
            <small class="form-text">
              Get your token from <a href="https://api.esv.org/" target="_blank" rel="noopener">api.esv.org</a>
            </small>
          </div>
                
          <div class="form-group">
            <div class="apocrypha-card">
              <div class="apocrypha-content">
                <div class="apocrypha-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                </div>
                <div class="apocrypha-text">
                  <h4>Include Apocrypha</h4>
                  <p>Show apocryphal books and chapters in the Bible tracker. This includes books like Tobit, Judith, Wisdom, and others.</p>
                </div>
                <div class="apocrypha-toggle">
                  <input
                    type="checkbox"
                    id="includeApocrypha"
                    class="toggle-input"
                    [(ngModel)]="profileForm.includeApocrypha"
                    name="includeApocrypha">
                  <label for="includeApocrypha" class="toggle-switch-label">
                    <span class="toggle-switch"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
                
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="isSaving || !isFormValid()">
              <svg *ngIf="!isSaving" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V2" />
              </svg>
              <div *ngIf="isSaving" class="button-spinner"></div>
              <span>{{ isSaving ? 'Saving...' : 'Save Changes' }}</span>
            </button>
          </div>
        </form>

        <!-- Danger Zone -->
        <div class="danger-zone">
          <h3>Danger Zone</h3>
          <p>Clear your memorization data and start from scratch.</p>
          <div class="danger-actions">
            <button type="button" class="btn btn-danger" (click)="clearAllData()">
              Clear All Data
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>