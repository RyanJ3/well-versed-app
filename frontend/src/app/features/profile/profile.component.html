<!-- frontend/src/app/features/profile/profile.component.html -->
<div class="profile-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && user" class="profile-layout">
    <!-- Compact Header -->
    <div class="profile-header">
      <div class="header-content">
        <div class="header-left">
          <div class="user-avatar">
            <span>{{ getInitial() }}</span>
          </div>
          <div class="user-info">
            <h1 class="page-title">Profile Settings</h1>
            <p class="page-subtitle">Manage your account preferences</p>
          </div>
        </div>
        <div class="header-right">
          <div *ngIf="hasUnsavedChanges()" class="unsaved-indicator">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span>Unsaved changes</span>
          </div>
          <div class="auto-save-toggle">
            <label class="toggle-label">
              <input 
                type="checkbox" 
                [(ngModel)]="autoSaveEnabled" 
                (change)="onAutoSaveToggle()"
              >
              <span class="toggle-switch"></span>
              <span class="toggle-text">Auto-save</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-container">
      <!-- Mobile Menu Toggle -->
      <button 
        class="mobile-menu-toggle"
        (click)="toggleMobileSidebar()"
        [class.active]="mobileSidebarOpen"
      >
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>

      <!-- Sidebar Navigation -->
      <nav 
        class="profile-sidebar"
        [class.mobile-open]="mobileSidebarOpen"
      >
        <div 
          class="sidebar-backdrop"
          (click)="closeMobileSidebar()"
          *ngIf="mobileSidebarOpen"
        ></div>
        <div class="sidebar-content">
          <button
            *ngFor="let section of sections"
            (click)="setActiveSection(section.id)"
            [class.active]="activeSection === section.id"
            [class.has-changes]="sectionHasChanges(section.id)"
            class="sidebar-item"
            [attr.data-section]="section.id"
          >
            <svg *ngIf="section.id === 'personal'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <svg *ngIf="section.id === 'bible'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
            <svg *ngIf="section.id === 'study'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            <svg *ngIf="section.id === 'display'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
            </svg>
            <span>{{ section.label }}</span>
            <span class="change-indicator" *ngIf="sectionHasChanges(section.id)">•</span>
            <svg class="chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </nav>

      <!-- Main Content Area -->
      <div class="profile-content">
        <!-- Success Alert -->
        <div class="alert alert-success" *ngIf="showSuccess">
          <div class="alert-content">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="alert-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div class="alert-text">
              <strong>Success!</strong> Profile updated successfully.
              <span *ngIf="profileForm.includeApocrypha"> Apocryphal books are now visible.</span>
              <span *ngIf="!profileForm.includeApocrypha"> Apocryphal books are now hidden.</span>
            </div>
            <button class="alert-close" (click)="dismissSuccess()">×</button>
          </div>
        </div>

        <!-- Section Content -->
        <div class="section-wrapper">
          <!-- Personal Information Section -->
          <app-profile-personal-section
            [active]="activeSection === 'personal'"
            [profileForm]="profileForm"
            [denominationOptions]="denominationOptions"
            [user]="user"
            (fieldChange)="onFieldChange('personal')"
          ></app-profile-personal-section>

          <!-- Bible & Reading Section -->
          <app-profile-bible-section
            [active]="activeSection === 'bible'"
            [profileForm]="profileForm"
            [languages]="languages"
            [availableBibles]="availableBibles"
            [loadingBibles]="loadingBibles"
            [selectedBibleId]="selectedBibleId"
            [isEsvSelected]="isEsvSelected"
            (fieldChange)="onFieldChange('bible')"
            (languageChange)="onLanguageChange()"
            (bibleChange)="onBibleChange()"
          ></app-profile-bible-section>

          <!-- Study Preferences Section -->
          <app-profile-study-section
            [active]="activeSection === 'study'"
            [profileForm]="profileForm"
            (fieldChange)="onFieldChange('study')"
          ></app-profile-study-section>

          <!-- Theme & Display Section -->
          <app-profile-display-section
            [active]="activeSection === 'display'"
            [profileForm]="profileForm"
            (fieldChange)="onFieldChange('display')"
            (openClearData)="openClearDataModal()"
          ></app-profile-display-section>

          <!-- Action buttons - only show for sections with forms -->
          <div class="form-actions" *ngIf="shouldShowSaveButtons(activeSection)">
            <button 
              type="button" 
              class="btn btn-primary" 
              [disabled]="isSaving || !isFormValid || !hasUnsavedChanges()" 
              (click)="saveProfile()"
            >
              <svg *ngIf="!isSaving" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
              </svg>
              <span *ngIf="!isSaving">Save Changes</span>
              <span *ngIf="isSaving">Saving...</span>
            </button>
            <button 
              type="button" 
              class="btn btn-secondary" 
              (click)="cancelChanges()" 
              [disabled]="!hasUnsavedChanges() || isSaving"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Clear Data Modal -->
  <div class="modal-backdrop" *ngIf="showClearDataModal" (click)="closeClearDataModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="danger-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <h2>Clear All Data</h2>
      </div>
      
      <div class="modal-body">
        <p class="warning-text">
          This action will permanently delete:
        </p>
        <ul class="deletion-list">
          <li>All memorized verses</li>
          <li>Progress statistics</li>
          <li>Study history</li>
          <li>Achievement records</li>
        </ul>
        <p class="info-text">
          Your account and settings will remain intact.
        </p>
        
        <div class="confirmation-section">
          <label for="confirm-input">Type <strong>delete all data</strong> to confirm:</label>
          <input 
            type="text" 
            id="confirm-input"
            class="form-control" 
            [(ngModel)]="confirmText"
            placeholder="delete all data"
            (keyup.enter)="confirmClearData()"
          >
        </div>
      </div>
      
      <div class="modal-footer">
        <button 
          class="btn btn-secondary" 
          (click)="closeClearDataModal()"
          [disabled]="isClearing"
        >
          Cancel
        </button>
        <button 
          class="btn btn-danger" 
          (click)="confirmClearData()"
          [disabled]="!isConfirmEnabled || isClearing"
        >
          <span *ngIf="!isClearing">Clear All Data</span>
          <span *ngIf="isClearing">Clearing...</span>
        </button>
      </div>
    </div>
  </div>
</div>
