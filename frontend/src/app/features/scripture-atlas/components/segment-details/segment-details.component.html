<!-- Side Panel for Desktop / Bottom Sheet for Mobile -->
<div class="details-panel" 
     [class.expanded]="!collapsed"
     [class.peek]="collapsed && segment"
     [class.mobile]="isMobile"
     *ngIf="segment">
  
  <!-- Drag Handle -->
  <div class="drag-handle" 
       (click)="toggleCollapse()"
       (touchstart)="onTouchStart($event)"
       (touchmove)="onTouchMove($event)"
       (touchend)="onTouchEnd($event)">
    <div class="handle-bar"></div>
  </div>
  
  <!-- Sheet Header -->
  <div class="sheet-header" (click)="!collapsed && toggleCollapse()">
    <div class="header-content">
      <h3 class="segment-title" [class.updating]="isUpdating">
        {{ segment.from.location_name }} ‚Üí {{ segment.to.location_name }}
      </h3>
      <span class="distance" *ngIf="segment.distance" [class.updating]="isUpdating">
        {{ segment.distance }} km
      </span>
    </div>
    <button class="expand-btn" 
            *ngIf="collapsed"
            (click)="toggleCollapse(); $event.stopPropagation()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
  </div>
  
  <!-- Sheet Content -->
  <div class="sheet-content" [class.visible]="!collapsed" [class.updating]="isUpdating">
    <!-- Segment Description -->
    <p class="segment-description" *ngIf="segment.description">
      {{ segment.description }}
    </p>
    
    <!-- Key Events -->
    <div class="events-section" *ngIf="segment.events && segment.events.length > 0">
      <h4 class="events-title">Key Events</h4>
      <div class="events-list">
        <div 
          class="event-item" 
          *ngFor="let event of segment.events"
          (mouseenter)="highlightEvent(event)"
          (mouseleave)="unhighlightEvent()">
          
          <div class="event-header">
            <span class="event-icon">{{ getEventIcon(event) }}</span>
            <h5 class="event-title">{{ event.title }}</h5>
          </div>
          
          <p class="event-description">{{ event.description }}</p>
          
          <div class="scripture-refs" *ngIf="event.scriptures && event.scriptures.length > 0">
            <span class="scripture-icon">üìñ</span>
            <span class="scripture-list">
              <span 
                *ngFor="let scripture of event.scriptures; let last = last"
                class="scripture-ref">
                {{ scripture }}<span *ngIf="!last">, </span>
              </span>
            </span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Travel Info -->
    <div class="travel-info" *ngIf="segment.travelMode || segment.dayRange">
      <div class="info-item" *ngIf="segment.travelMode">
        <span class="info-icon">{{ getTravelIcon(segment.travelMode) }}</span>
        <span class="info-text">{{ getTravelModeText(segment.travelMode) }}</span>
      </div>
      <div class="info-item" *ngIf="segment.dayRange">
        <span class="info-icon">‚è±Ô∏è</span>
        <span class="info-text">{{ segment.dayRange }}</span>
      </div>
    </div>
  </div>
</div>

<!-- Mobile FAB for Details -->
<button class="details-fab" 
        *ngIf="segment && collapsed"
        (click)="toggleCollapse()"
        class="mobile-only">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
  </svg>
</button>