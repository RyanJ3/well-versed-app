<div class="journey-container">
    <div class="controls-panel" [class.collapsed]="controlsCollapsed">
        <button class="toggle-controls" (click)="controlsCollapsed = !controlsCollapsed">
            {{ controlsCollapsed ? '☰' : '✕' }}
        </button>

        <div class="controls-content" *ngIf="!controlsCollapsed">
            <div class="view-controls">
                <button (click)="setView('2d')" [class.active]="currentView === '2d'">2D Map</button>
                <button (click)="setView('3d')" [class.active]="currentView === '3d'">3D View</button>
                <button (click)="setView('historical')"
                    [class.active]="currentView === 'historical'">Historical</button>
                <button (click)="toggleFirstPerson()" [class.active]="isFirstPerson">
                    {{ isFirstPerson ? 'Exit Walk Mode' : 'Walk Mode' }}
                </button>
            </div>

            <div class="journey-selector">
                <label>Select Journey:</label>
                <select (change)="onJourneyChange($event)" [value]="currentJourney.id">
                    <option *ngFor="let journey of journeys" [value]="journey.id">
                        {{ journey.name }}
                    </option>
                </select>
            </div>

            <div class="journey-info">
                <h3>{{ currentJourney.name }}</h3>
                <p>{{ currentJourney.description }}</p>
            </div>

            <div class="navigation-controls">
                <button (click)="previousSegment()" [disabled]="currentSegmentIndex === 0">
                    ← Previous
                </button>
                <span class="segment-counter">
                    Stop {{ currentSegmentIndex + 1 }} of {{ currentJourney.segments.length }}
                </span>
                <button (click)="nextSegment()" [disabled]="currentSegmentIndex === currentJourney.segments.length - 1">
                    Next →
                </button>
            </div>

            <div class="animation-controls">
                <button (click)="toggleAnimation()" [class.playing]="isAnimating">
                    {{ isAnimating ? '⏸ Pause' : '▶ Play' }} Journey
                </button>
                <input type="range" min="1" max="10" [(ngModel)]="animationSpeed" (change)="updateAnimationSpeed()"
                    [disabled]="!isAnimating">
                <span>Speed: {{ animationSpeed }}x</span>
            </div>

            <div class="segment-details" *ngIf="currentSegment">
                <h4>{{ currentSegment.from.name }} → {{ currentSegment.to.name }}</h4>
                <p *ngIf="currentSegment.dayRange" class="day-range">{{ currentSegment.dayRange }}</p>
                <div *ngFor="let event of currentSegment.events" class="event" (mouseenter)="highlightEvent(event)"
                    (mouseleave)="unhighlightEvent()">
                    <h5>{{ event.title }}</h5>
                    <p>{{ event.description }}</p>
                    <div class="scriptures">
                        <strong>Scripture References:</strong>
                        <ul>
                            <li *ngFor="let scripture of event.scriptures">{{ scripture }}</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="time-controls">
                <label>Time of Day:</label>
                <input type="range" min="0" max="24" step="0.5" [(ngModel)]="timeOfDay" (input)="updateTimeOfDay()">
                <span>{{ formatTime(timeOfDay) }}</span>
            </div>
        </div>
    </div>

    <div #mapContainer class="map-container"></div>

    <div class="info-popup" *ngIf="hoveredLocation" [style.left.px]="popupPosition.x" [style.top.px]="popupPosition.y">
        <h4>{{ hoveredLocation.name }}</h4>
        <p *ngIf="hoveredLocation.ancientName">Ancient: {{ hoveredLocation.ancientName }}</p>
        <p *ngIf="hoveredLocation.elevation">Elevation: {{ hoveredLocation.elevation }}m</p>
    </div>
</div>