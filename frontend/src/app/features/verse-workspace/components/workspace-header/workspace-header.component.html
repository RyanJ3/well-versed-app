<div class="flow-header-glass" 
     [class.cross-ref-mode]="mode === 'crossReferences'"
     [class.topical-mode]="mode === 'topical'"
     [class.memorization-mode]="mode === 'memorization'">
  <!-- Subtle animated mesh background -->
  <div class="animated-mesh"></div>

  <!-- Main header content -->
  <div class="header-glass-container">

    <!-- Header Bar - Always visible, no collapse -->
    <div class="header-bar">
      <!-- Mode-specific content -->
      <ng-container [ngSwitch]="mode">
        
        <!-- Verse-by-verse Mode (memorization) -->
        <ng-container *ngSwitchCase="'memorization'">
          <!-- Book Selector -->
          <div class="book-selector-wrapper">
            <button class="selector-btn book-selector" (click)="toggleBookDropdown($event)">
              <span class="selector-text">{{ currentBook?.name || 'Genesis' }}</span>
              <span class="selector-arrow" [class.open]="showBookDropdown">â–¼</span>
            </button>
            
            <!-- Book Dropdown -->
            <div class="dropdown-menu book-dropdown" *ngIf="showBookDropdown">
              <!-- Testament filter -->
              <div class="testament-filter">
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'ALL'"
                  (click)="setTestamentFilter('ALL')">
                  ALL
                </button>
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'OT'"
                  (click)="setTestamentFilter('OT')">
                  OT
                </button>
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'NT'"
                  (click)="setTestamentFilter('NT')">
                  NT
                </button>
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'APO'"
                  (click)="setTestamentFilter('APO')">
                  APO
                </button>
              </div>
              
              <div class="dropdown-section" *ngIf="booksByTestament.OT.length > 0">
                <div class="dropdown-header">Old Testament</div>
                <button *ngFor="let book of booksByTestament.OT" 
                        class="dropdown-item"
                        [class.current]="book.id === currentBook?.id"
                        (click)="onBookSelect(book.id)">
                  {{ book.name }}
                  <span class="item-badge">{{ getBookProgress(book) }}%</span>
                </button>
              </div>
              <div class="dropdown-section" *ngIf="booksByTestament.NT.length > 0">
                <div class="dropdown-header">New Testament</div>
                <button *ngFor="let book of booksByTestament.NT"
                        class="dropdown-item"
                        [class.current]="book.id === currentBook?.id"
                        (click)="onBookSelect(book.id)">
                  {{ book.name }}
                  <span class="item-badge">{{ getBookProgress(book) }}%</span>
                </button>
              </div>
              <div class="dropdown-section" *ngIf="booksByTestament.APO.length > 0">
                <div class="dropdown-header">Apocrypha</div>
                <button *ngFor="let book of booksByTestament.APO"
                        class="dropdown-item"
                        [class.current]="book.id === currentBook?.id"
                        (click)="onBookSelect(book.id)">
                  {{ book.name }}
                  <span class="item-badge">{{ getBookProgress(book) }}%</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Chapter Selector -->
          <div class="chapter-selector-wrapper">
            <button class="selector-btn chapter-selector" (click)="toggleChapterDropdown($event)">
              <span class="selector-text">Chapter {{ currentChapter }}</span>
              <span class="selector-arrow" [class.open]="showChapterDropdown">â–¼</span>
            </button>
            
            <!-- Chapter Dropdown -->
            <div class="dropdown-menu chapter-dropdown" *ngIf="showChapterDropdown">
              <button *ngFor="let ch of availableChapters"
                      class="dropdown-item"
                      [class.current]="ch.chapterNumber === currentChapter"
                      (click)="onChapterClick(ch.chapterNumber)">
                Chapter {{ ch.chapterNumber }}
                <span class="item-badge">{{ getChapterProgress(ch) }}%</span>
              </button>
            </div>
          </div>

        </ng-container>

        <!-- Cross References Mode -->
        <ng-container *ngSwitchCase="'crossReferences'">
          <!-- Mode Indicator -->
          <div class="mode-indicator cross-ref">
            <span class="mode-icon">ðŸ”—</span>
            <span>Cross References</span>
          </div>

          <!-- Book Selector -->
          <div class="book-selector-wrapper">
            <button class="selector-btn book-selector" (click)="toggleBookDropdown($event)">
              <span class="selector-text">{{ currentBook?.name || 'Genesis' }}</span>
              <span class="selector-arrow" [class.open]="showBookDropdown">â–¼</span>
            </button>
            
            <!-- Book Dropdown -->
            <div class="dropdown-menu book-dropdown" *ngIf="showBookDropdown">
              <!-- Testament filter -->
              <div class="testament-filter">
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'ALL'"
                  (click)="setTestamentFilter('ALL')">
                  ALL
                </button>
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'OT'"
                  (click)="setTestamentFilter('OT')">
                  OT
                </button>
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'NT'"
                  (click)="setTestamentFilter('NT')">
                  NT
                </button>
                <button 
                  class="filter-btn" 
                  [class.active]="testamentFilter === 'APO'"
                  (click)="setTestamentFilter('APO')">
                  APO
                </button>
              </div>
              
              <div class="dropdown-section" *ngIf="booksByTestament.OT.length > 0">
                <div class="dropdown-header">Old Testament</div>
                <button *ngFor="let book of booksByTestament.OT" 
                        class="dropdown-item"
                        [class.current]="book.id === currentBook?.id"
                        (click)="onBookSelect(book.id)">
                  {{ book.name }}
                  <span class="item-badge">{{ getBookProgress(book) }}%</span>
                </button>
              </div>
              <div class="dropdown-section" *ngIf="booksByTestament.NT.length > 0">
                <div class="dropdown-header">New Testament</div>
                <button *ngFor="let book of booksByTestament.NT"
                        class="dropdown-item"
                        [class.current]="book.id === currentBook?.id"
                        (click)="onBookSelect(book.id)">
                  {{ book.name }}
                  <span class="item-badge">{{ getBookProgress(book) }}%</span>
                </button>
              </div>
              <div class="dropdown-section" *ngIf="booksByTestament.APO.length > 0">
                <div class="dropdown-header">Apocrypha</div>
                <button *ngFor="let book of booksByTestament.APO"
                        class="dropdown-item"
                        [class.current]="book.id === currentBook?.id"
                        (click)="onBookSelect(book.id)">
                  {{ book.name }}
                  <span class="item-badge">{{ getBookProgress(book) }}%</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Chapter Selector -->
          <div class="chapter-selector-wrapper">
            <button class="selector-btn chapter-selector" (click)="toggleChapterDropdown($event)">
              <span class="selector-text">Chapter {{ currentChapter }}</span>
              <span class="selector-arrow" [class.open]="showChapterDropdown">â–¼</span>
            </button>
            
            <!-- Chapter Dropdown -->
            <div class="dropdown-menu chapter-dropdown" *ngIf="showChapterDropdown">
              <button *ngFor="let ch of availableChapters"
                      class="dropdown-item"
                      [class.current]="ch.chapterNumber === currentChapter"
                      (click)="onChapterClick(ch.chapterNumber)">
                Chapter {{ ch.chapterNumber }}
                <span class="item-badge">{{ getChapterProgress(ch) }}%</span>
              </button>
            </div>
          </div>
          
          <!-- Verse Selector -->
          <div class="verse-selector-wrapper">
            <button class="selector-btn verse-selector" (click)="toggleVerseDropdown($event)">
              <span class="selector-text">Verse {{ selectedVerseNumber || 1 }}</span>
              <span class="selector-arrow" [class.open]="showVerseDropdown">â–¼</span>
            </button>
            
            <!-- Verse Dropdown -->
            <div class="dropdown-menu verse-dropdown" *ngIf="showVerseDropdown">
              <button *ngFor="let verseNum of availableVerseNumbers"
                      class="dropdown-item"
                      [class.current]="verseNum === selectedVerseNumber"
                      (click)="onVerseClick(verseNum)">
                Verse {{ verseNum }}
              </button>
            </div>
          </div>
          
        </ng-container>

        <!-- Topical Mode -->
        <ng-container *ngSwitchCase="'topical'">
          <!-- Mode Indicator -->
          <div class="mode-indicator topical">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Topical Study</span>
          </div>

          <!-- Topic Picker (included via ng-content) -->
          <div class="topic-picker-container">
            <ng-content></ng-content>
          </div>
        </ng-container>
      </ng-container>
      
      <!-- Empty action buttons for memorization mode - moved to sidebar -->
      
      <!-- Empty action buttons for cross-references mode -->
      
      <!-- Empty action buttons for topical mode -->
    </div>

    <!-- Verse Picker for Cross References Mode -->
    <ng-content select="app-verse-picker"></ng-content>
  </div>
</div>