<div class="flow-header-glass" 
     [class.cross-ref-mode]="mode === 'crossReferences'"
     [class.topical-mode]="mode === 'topical'"
     [class.memorization-mode]="mode === 'memorization'">
  <!-- Subtle animated mesh background -->
  <div class="animated-mesh"></div>

  <!-- Main header content -->
  <div class="header-glass-container">

    <!-- Header Bar - Always visible, no collapse -->
    <div class="header-bar">
      <!-- Mode-specific content -->
      <ng-container [ngSwitch]="mode">
        
        <!-- Verse-by-verse Mode (memorization) -->
        <ng-container *ngSwitchCase="'memorization'">
          <!-- Book Selector -->
          <div class="book-selector-wrapper">
            <div class="book-selector" (click)="toggleBookDropdown($event)">
              <span class="book-icon">ðŸ“–</span>
              <span class="book-name">{{ currentBook?.name || 'Genesis' }}</span>
              <span class="dropdown-arrow" [class.open]="showBookDropdown">â–¼</span>
            </div>
          </div>

          <!-- Chapter Selector -->
          <div class="chapter-selector-wrapper">
            <div class="chapter-selector" (click)="toggleChapterDropdown($event)">
              <span class="chapter-text">Ch {{ currentChapter }}</span>
              <span class="dropdown-arrow" [class.open]="showChapterDropdown">â–¼</span>
            </div>
          </div>

          <!-- Chapter Progress Bar -->
          <div class="header-progress-bar">
            <div class="progress-track">
              <div class="progress-fill" [style.width.%]="chapterProgressPercentage"></div>
            </div>
            <span class="progress-text">{{ chapterProgressPercentage }}%</span>
          </div>
        </ng-container>

        <!-- Cross References Mode -->
        <ng-container *ngSwitchCase="'crossReferences'">
          <!-- Mode Indicator -->
          <div class="mode-indicator cross-ref">
            <span class="mode-icon">ðŸ”—</span>
            <span>Cross References</span>
          </div>

          <!-- Book Selector -->
          <div class="book-selector-wrapper">
            <div class="book-selector" (click)="toggleBookDropdown($event)">
              <span class="book-icon">ðŸ“–</span>
              <span class="book-name">{{ currentBook?.name || 'Genesis' }}</span>
              <span class="dropdown-arrow" [class.open]="showBookDropdown">â–¼</span>
            </div>
          </div>

          <!-- Chapter Selector -->
          <div class="chapter-selector-wrapper">
            <div class="chapter-selector" (click)="toggleChapterDropdown($event)">
              <span class="chapter-text">Ch {{ currentChapter }}</span>
              <span class="dropdown-arrow" [class.open]="showChapterDropdown">â–¼</span>
            </div>
          </div>
        </ng-container>

        <!-- Topical Mode -->
        <ng-container *ngSwitchCase="'topical'">
          <!-- Mode Indicator -->
          <div class="mode-indicator topical">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
            <span>Topical Study Mode</span>
          </div>

          <!-- Topic Picker (will be included via ng-content) -->
          <div class="topic-picker-container">
            <ng-content select="app-topic-picker"></ng-content>
          </div>
        </ng-container>
      </ng-container>
      
      <!-- Empty action buttons for memorization mode - moved to sidebar -->
      
      <!-- Empty action buttons for cross-references mode -->
      
      <!-- Empty action buttons for topical mode -->
    </div>

    <!-- Verse Picker for Cross References Mode -->
    <ng-content select="app-verse-picker"></ng-content>
  </div>
  
  <!-- Dropdowns positioned outside main container -->
  <!-- Book dropdown menu -->
  <div class="book-dropdown-menu" *ngIf="showBookDropdown" (click)="$event.stopPropagation()">
    <!-- Testament filter inside dropdown -->
    <div class="dropdown-testament-filter">
      <button [class.active]="testamentFilter === 'ALL'"
        (click)="setTestamentFilter('ALL'); $event.stopPropagation()">ALL</button>
      <button [class.active]="testamentFilter === 'OT'"
        (click)="setTestamentFilter('OT'); $event.stopPropagation()">OT</button>
      <button [class.active]="testamentFilter === 'NT'"
        (click)="setTestamentFilter('NT'); $event.stopPropagation()">NT</button>
      <button [class.active]="testamentFilter === 'APO'"
        (click)="setTestamentFilter('APO'); $event.stopPropagation()">APO</button>
    </div>
    
    <!-- Old Testament Books -->
    <div *ngIf="booksByTestament.OT.length > 0">
      <div class="dropdown-header">Old Testament</div>
      <div *ngFor="let book of booksByTestament.OT" class="book-dropdown-item"
        [class.current]="book.id === currentBook?.id"
        (click)="onBookSelect(book.id); showBookDropdown = false; $event.stopPropagation()">
        <span>{{ book.name }}</span>
        <span class="book-progress-badge">{{ getBookProgress(book) }}%</span>
      </div>
    </div>

    <!-- New Testament Books -->
    <div *ngIf="booksByTestament.NT.length > 0">
      <div class="dropdown-header">New Testament</div>
      <div *ngFor="let book of booksByTestament.NT" class="book-dropdown-item"
        [class.current]="book.id === currentBook?.id"
        (click)="onBookSelect(book.id); showBookDropdown = false; $event.stopPropagation()">
        <span>{{ book.name }}</span>
        <span class="book-progress-badge">{{ getBookProgress(book) }}%</span>
      </div>
    </div>

    <!-- Apocrypha Books -->
    <div *ngIf="booksByTestament.APO.length > 0">
      <div class="dropdown-header">Apocrypha</div>
      <div *ngFor="let book of booksByTestament.APO" class="book-dropdown-item"
        [class.current]="book.id === currentBook?.id"
        (click)="onBookSelect(book.id); showBookDropdown = false; $event.stopPropagation()">
        <span>{{ book.name }}</span>
        <span class="book-progress-badge">{{ getBookProgress(book) }}%</span>
      </div>
    </div>
  </div>
  
  <!-- Chapter dropdown menu -->
  <div class="chapter-dropdown-menu" *ngIf="showChapterDropdown" (click)="$event.stopPropagation()">
    <div *ngFor="let ch of availableChapters"
      class="chapter-dropdown-item"
      [class.current]="ch.chapterNumber === currentChapter"
      (click)="onChapterClick(ch.chapterNumber); showChapterDropdown = false; $event.stopPropagation()">
      <span>Chapter {{ ch.chapterNumber }}</span>
      <span class="chapter-progress-badge">
        {{ getChapterProgress(ch) }}%
      </span>
    </div>
  </div>
</div>