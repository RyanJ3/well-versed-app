<div class="practice-layout">
  <div class="practice-wrapper">
    <div
      class="verse-display"
      [style.font-size.px]="practiceSettings.fontSize"
      *ngIf="currentStepIndex !== 2"
    >
      <div
        *ngIf="practiceSettings.layoutMode === 'column'"
        class="column-layout"
      >
        <div
          class="verse-block"
          *ngFor="let v of currentVerses; let idx = index"
          [@verseTransition]="currentStepIndex"
        >
          <p class="verse-ref">{{ v.verse }}</p>
          <p
            class="verse-text"
            [class.memory-mode]="currentStepIndex === 2"
          >
            {{ getVerseDisplay(v) }}
          </p>
        </div>
      </div>

      <div
        *ngIf="practiceSettings.layoutMode === 'paragraph'"
        class="paragraph-layout"
      >
        <p class="verse-paragraph">
          <span *ngFor="let v of currentVerses; let idx = index">
            <sup class="verse-ref-inline">{{ v.verse }}</sup>
            <span
              class="verse-text"
              [class.memory-mode]="currentStepIndex === 2"
              >{{ getVerseDisplay(v) }}</span
            >
            <span *ngIf="idx < currentVerses.length - 1"> </span>
          </span>
        </p>
      </div>
    </div>
  </div>
  <div class="memory-message" *ngIf="currentStepIndex === 2">
    You're doing great! Recite it from memory!
  </div>
</div>
<div class="nav-buttons">
  <button class="prev-btn" (click)="onPrev()" [disabled]="!canGoBack">
    Previous
  </button>
  <div class="bottom-controls">
    <button
      *ngFor="let step of stageNames; let i = index"
      class="step-circle"
      [class.active]="currentStepIndex === i"
      (click)="onJumpToStep(i)"
      [title]="step"
    >
      {{ getStageIcon(step) }}
    </button>
    <div class="settings-container">
      <button
        class="step-circle settings-btn"
        [class.spinning]="isGearSpinning"
        (click)="toggleSettingsDropdown()"
        title="Settings"
      >
        ⚙️
      </button>
      <div class="settings-menu" [class.active]="showSettingsDropdown">
        <div class="panel-section settings-section">
          <h3 class="panel-title">Settings</h3>

          <div class="setting-group">
            <label>Font Size</label>
            <div class="font-controls">
              <button class="font-btn" (click)="decreaseFontSize()">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
              <span class="font-value"
                >{{ practiceSettings.fontSize }}px</span
              >
              <button class="font-btn" (click)="increaseFontSize()">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </button>
            </div>
          </div>

          <div class="setting-group">
            <label>Layout</label>
            <div class="layout-toggle">
              <button
                class="layout-option"
                [class.active]="practiceSettings.layoutMode === 'column'"
                (click)="setLayoutMode('column')"
              >
                Column
              </button>
              <button
                class="layout-option"
                [class.active]="practiceSettings.layoutMode === 'paragraph'"
                (click)="setLayoutMode('paragraph')"
              >
                Paragraph
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <button class="next-btn" (click)="onNext()" [disabled]="isSaving">
    Next
  </button>
</div>
